import{d as R,c as G,w as M,e as x,r as I}from"./loaders-CNHm-dlv.js";import{c as C,a as B}from"./input-BV31AzWF.js";import{c as D}from"./loop-24SuRqx9.js";import{a as H,c as h,d as $}from"./index-niTdxgfr.js";const c="shooter",t=R(c),P=G(),l=P.find(o=>o.id===(t==null?void 0:t.themeId))||P[0];H();const v=new Image;v.src=new URL("data:image/svg+xml,%3csvg%20width='120'%20height='140'%20viewBox='0%200%20120%20140'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cdefs%3e%3clinearGradient%20id='shipBody'%20x1='0'%20y1='0'%20x2='1'%20y2='1'%3e%3cstop%20stop-color='%237CFFE1'%20/%3e%3cstop%20offset='1'%20stop-color='%237B8CFF'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='shipGlow'%20x1='0'%20y1='0'%20x2='1'%20y2='1'%3e%3cstop%20stop-color='%23ffffff'%20stop-opacity='0.8'%20/%3e%3cstop%20offset='1'%20stop-color='%23ffffff'%20stop-opacity='0.1'%20/%3e%3c/linearGradient%3e%3c/defs%3e%3cpath%20d='M60%208L92%20120H28L60%208Z'%20fill='url(%23shipBody)'%20stroke='%230AF0FF'%20stroke-width='4'%20/%3e%3cpath%20d='M60%2024L78%20118H42L60%2024Z'%20fill='url(%23shipGlow)'%20/%3e%3ccircle%20cx='60'%20cy='86'%20r='10'%20fill='%230A1224'%20/%3e%3cpath%20d='M44%20122h32l-16%2012-16-12Z'%20fill='%230A1224'%20opacity='0.8'%20/%3e%3c/svg%3e",import.meta.url).href;const g=new Image;g.src=new URL("data:image/svg+xml,%3csvg%20width='120'%20height='120'%20viewBox='0%200%20120%20120'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cdefs%3e%3cradialGradient%20id='eye'%20cx='0'%20cy='0'%20r='1'%20gradientUnits='userSpaceOnUse'%20gradientTransform='translate(60%2060)%20scale(52)'%3e%3cstop%20stop-color='%23FF7EE2'/%3e%3cstop%20offset='1'%20stop-color='%23320726'/%3e%3c/radialGradient%3e%3c/defs%3e%3ccircle%20cx='60'%20cy='60'%20r='54'%20fill='url(%23eye)'%20stroke='%23FF7EE2'%20stroke-width='6'%20/%3e%3crect%20x='40'%20y='32'%20width='40'%20height='56'%20rx='12'%20fill='%230A0F1F'%20stroke='%23FFB6F2'%20stroke-width='4'/%3e%3crect%20x='52'%20y='46'%20width='16'%20height='28'%20rx='8'%20fill='%2300F5A0'/%3e%3crect%20x='22'%20y='54'%20width='8'%20height='12'%20rx='4'%20fill='%23FF7EE2'/%3e%3crect%20x='90'%20y='54'%20width='8'%20height='12'%20rx='4'%20fill='%23FF7EE2'/%3e%3c/svg%3e",import.meta.url).href;const b=new Image;b.src=new URL("data:image/svg+xml,%3csvg%20width='24'%20height='38'%20viewBox='0%200%2024%2038'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cdefs%3e%3clinearGradient%20id='bolt'%20x1='0'%20y1='0'%20x2='0'%20y2='1'%3e%3cstop%20stop-color='%237CFFE1'/%3e%3cstop%20offset='1'%20stop-color='%237B8CFF'/%3e%3c/linearGradient%3e%3c/defs%3e%3crect%20x='6'%20y='2'%20width='12'%20height='30'%20rx='6'%20fill='url(%23bolt)'%20stroke='%230AF0FF'%20stroke-width='2'/%3e%3crect%20x='10'%20y='26'%20width='4'%20height='10'%20rx='2'%20fill='%23ffffff'%20fill-opacity='0.8'/%3e%3c/svg%3e",import.meta.url).href;if(l){const o=document.documentElement.style;o.setProperty("--color-primary",l.colors.primary),o.setProperty("--color-secondary",l.colors.secondary),o.setProperty("--color-accent",l.colors.accent),o.setProperty("--color-text",l.colors.text),o.setProperty("--color-muted",l.colors.muted),document.body.style.background=l.gradient||document.body.style.background}const u=document.getElementById("game-canvas"),w=document.getElementById("ui"),i=u.getContext("2d"),m=C(),y=document.createElement("div");y.className="overlay";y.style.display="none";w.appendChild(y);const a={up:(t==null?void 0:t.input.keys.up)||"ArrowUp",down:(t==null?void 0:t.input.keys.down)||"ArrowDown",left:(t==null?void 0:t.input.keys.left)||"ArrowLeft",right:(t==null?void 0:t.input.keys.right)||"ArrowRight",shoot:(t==null?void 0:t.input.keys.shoot)||"Space"};B({container:document.body,input:m,mapping:{up:a.up,down:a.down,left:a.left,right:a.right,actionA:a.shoot,actionALabel:"Tir"}});const e={running:!1,width:0,height:0,player:{x:0,y:0,r:14},bullets:[],enemies:[],score:0,combo:0,comboTimer:0,lastShot:0,spawnTimer:0,wave:1,waveTimer:(t==null?void 0:t.difficultyParams.waveLength)??30,lives:3};function A(){u.width=window.innerWidth*devicePixelRatio,u.height=window.innerHeight*devicePixelRatio,e.width=u.width/devicePixelRatio,e.height=u.height/devicePixelRatio}A();window.addEventListener("resize",A);const k=D({update:o=>N(o),render:O,fps:60});function _(){if(!t){E("Config manquante","Ajoute configs/games/shooter.config.json",!1);return}e.running=!0,e.player.x=e.width/2,e.player.y=e.height*.75,e.bullets=[],e.enemies=[],e.score=0,e.combo=0,e.comboTimer=0,e.spawnTimer=0,e.wave=1,e.waveTimer=t.difficultyParams.waveLength,e.lives=3,y.style.display="none",h({type:"SESSION_START",gameId:c}),k.start()}function L(o){e.running=!1,k.stop(),h({type:o?"SESSION_WIN":"SESSION_FAIL",gameId:c,payload:{score:e.score}}),$(c,(t==null?void 0:t.saveSchemaVersion)??1,n=>{const d=n.state.bestScore||0;e.score>d&&(n.state.bestScore=e.score,n.bestScore=e.score)}),E(o?"Vagues nettoyées":"Drone détruit",(t==null?void 0:t.uiText.help)||"")}function E(o,s,n=!0){y.style.display="grid",y.innerHTML=`
    <div class="panel">
      <p class="pill">Pixel Shooter</p>
      <h2>${o}</h2>
      <p>${s}</p>
      <div style="display:flex; gap:10px; justify-content:center; margin-top:12px;">
        ${n?'<button class="btn" id="play-btn">Lancer</button>':""}
        <a class="btn secondary" href="${M("/apps/hub/")}">Hub</a>
      </div>
    </div>
  `;const d=document.getElementById("play-btn");d==null||d.addEventListener("click",_)}E((t==null?void 0:t.uiText.title)||"Pixel Shooter",(t==null?void 0:t.uiText.help)||"");function N(o){if(!e.running||!t)return;if(e.lastShot+=o,e.spawnTimer+=o*1e3,e.comboTimer=Math.max(0,e.comboTimer-o),e.comboTimer<=0&&(e.combo=0),e.waveTimer-=o,e.waveTimer<=0){if(h({type:"WAVE_CLEARED",gameId:c}),e.wave+=1,e.wave>t.difficultyParams.wavesToWin){L(!0);return}e.waveTimer=t.difficultyParams.waveLength,e.spawnTimer=0}const s=(m.isDown(a.right)?1:0)+(m.isDown(a.left)?-1:0),n=(m.isDown(a.down)?1:0)+(m.isDown(a.up)?-1:0);e.player.x+=s*t.difficultyParams.playerSpeed*(o*60),e.player.y+=n*t.difficultyParams.playerSpeed*(o*60),e.player.x=x(e.player.x,e.player.r,e.width-e.player.r),e.player.y=x(e.player.y,e.height*.35,e.height-e.player.r);const d=a.shoot;if(m.isDown(d)&&e.lastShot>.18&&(e.bullets.push({x:e.player.x,y:e.player.y-8,speed:t.difficultyParams.bulletSpeed}),e.lastShot=0),e.spawnTimer>=t.difficultyParams.enemySpawnIntervalMs){e.spawnTimer=0;const r=I(e.player.x-60,e.player.x+60);e.enemies.push({x:x(r,20,e.width-20),y:-20,speed:t.difficultyParams.enemySpeed+e.wave*.2,vx:I(-.4,.4)})}e.bullets=e.bullets.map(r=>({...r,y:r.y-r.speed})).filter(r=>r.y>-10),e.enemies=e.enemies.filter(r=>{r.y+=r.speed,r.x+=r.vx,(r.x<10||r.x>e.width-10)&&(r.vx*=-1);const f=r.x-e.player.x,p=r.y-e.player.y;return Math.sqrt(f*f+p*p)<e.player.r+14?(e.lives-=1,h({type:"PLAYER_HIT",gameId:c}),e.lives>0):r.y<e.height+20});for(let r=e.enemies.length-1;r>=0;r--){const f=e.enemies[r];for(let p=e.bullets.length-1;p>=0;p--){const T=e.bullets[p],S=f.x-T.x,F=f.y-T.y;if(Math.sqrt(S*S+F*F)<16){e.enemies.splice(r,1),e.bullets.splice(p,1),e.score+=5*(1+Math.floor(e.combo/3)),e.combo+=1,e.comboTimer=2,h({type:"ENEMY_KILLED",gameId:c}),e.combo>0&&e.combo%5===0&&h({type:"COMBO_REACHED",gameId:c,payload:{combo:e.combo}});break}}}e.lives<=0&&L(!1)}function O(){i.save(),i.scale(devicePixelRatio,devicePixelRatio),i.clearRect(0,0,e.width,e.height);const o=e.player.r*3;v.complete?i.drawImage(v,e.player.x-o/2,e.player.y-o/2,o,o):(i.fillStyle=l.colors.primary,i.beginPath(),i.arc(e.player.x,e.player.y,e.player.r,0,Math.PI*2),i.fill()),e.bullets.forEach(s=>{b.complete?i.drawImage(b,s.x-8,s.y-18,16,30):(i.fillStyle=l.colors.secondary,i.fillRect(s.x-3,s.y-10,6,12))}),e.enemies.forEach(s=>{g.complete?i.drawImage(g,s.x-16,s.y-16,32,32):(i.fillStyle="#ff5afc",i.fillRect(s.x-12,s.y-12,24,24))}),i.restore(),U()}function U(){w.innerHTML="",w.appendChild(y);const o=document.createElement("div");o.className="hud",o.innerHTML=`
    <div class="pill">Score ${e.score}</div>
    <div class="pill">Wave ${e.wave}/${(t==null?void 0:t.difficultyParams.wavesToWin)??0}</div>
    <div class="pill">Combo ${e.combo} (${e.comboTimer.toFixed(1)}s)</div>
    <div class="pill">Vies ${e.lives}</div>
  `,w.appendChild(o)}
