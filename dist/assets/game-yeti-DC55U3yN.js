import{m as G,e as O,f as D,l as $,v as F,w as H,k as T,n as g,p as x,q as U,t as Z}from"./index-Cmf_HX6D.js";import{c as N,a as W}from"./input-CrBvr0XE.js";import{c as _}from"./loop-24SuRqx9.js";const f="yeti",r=G(f),w=O(),d=r&&w.find(t=>t.id===r.themeId)||w[0];D();var C,R;const z=((R=(C=$().games)==null?void 0:C[f])==null?void 0:R.bestScore)??0;if(d){const t=document.documentElement.style;t.setProperty("--color-primary",d.colors.primary),t.setProperty("--color-secondary",d.colors.secondary),t.setProperty("--color-accent",d.colors.accent),t.setProperty("--color-text",d.colors.text),t.setProperty("--color-muted",d.colors.muted),document.body.style.background=d.gradient||document.body.style.background}const M=new Image;M.src=new URL("data:image/svg+xml,%3csvg%20width='160'%20height='160'%20viewBox='0%200%20160%20160'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cdefs%3e%3clinearGradient%20id='body'%20x1='36'%20y1='20'%20x2='120'%20y2='144'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20stop-color='%230B1E35'/%3e%3cstop%20offset='1'%20stop-color='%2313395C'/%3e%3c/linearGradient%3e%3clinearGradient%20id='belly'%20x1='64'%20y1='54'%20x2='104'%20y2='126'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20stop-color='%23F9FCFF'/%3e%3cstop%20offset='1'%20stop-color='%23E5EFFA'/%3e%3c/linearGradient%3e%3clinearGradient%20id='shine'%20x1='54'%20y1='26'%20x2='82'%20y2='70'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20stop-color='%237BE0FF'%20stop-opacity='0.9'/%3e%3cstop%20offset='1'%20stop-color='%237BE0FF'%20stop-opacity='0'/%3e%3c/linearGradient%3e%3c/defs%3e%3cpath%20d='M80%2018c-28%200-50%2026-50%2058%200%2026%2012%2053%2050%2078%2038-25%2050-52%2050-78%200-32-22-58-50-58Z'%20fill='url(%23body)'%20stroke='%230AF0FF'%20stroke-width='4'%20stroke-linejoin='round'%20/%3e%3cpath%20d='M80%2034c-17%200-30%2016-30%2036%200%2016%208%2034%2030%2050%2022-16%2030-34%2030-50%200-20-13-36-30-36Z'%20fill='url(%23belly)'%20/%3e%3cellipse%20cx='80'%20cy='64'%20rx='22'%20ry='24'%20fill='url(%23shine)'%20/%3e%3cpath%20d='M68%20106c-8%2010-26%2010-30%204%202-6%2012-10%2022-10%204%200%206%202%208%206Z'%20fill='%23FFB157'%20opacity='0.9'%20/%3e%3cpath%20d='M92%20106c8%2010%2026%2010%2030%204-2-6-12-10-22-10-4%200-6%202-8%206Z'%20fill='%23FFB157'%20opacity='0.9'%20/%3e%3cpath%20d='M80%2068c6%200%2012%204%2012%206s-6%204-12%204-12-2-12-4%206-6%2012-6Z'%20fill='%23F2A950'%20/%3e%3ccircle%20cx='66'%20cy='54'%20r='8'%20fill='%230A0F1F'%20/%3e%3ccircle%20cx='94'%20cy='54'%20r='8'%20fill='%230A0F1F'%20/%3e%3ccircle%20cx='64'%20cy='52'%20r='3'%20fill='%23fff'%20/%3e%3ccircle%20cx='92'%20cy='52'%20r='3'%20fill='%23fff'%20/%3e%3cpath%20d='M80%2078c-6%206-12%2010-12%2016%200%203%204%208%2012%208s12-5%2012-8c0-6-6-10-12-16Z'%20fill='%23FFB157'%20opacity='0.9'%20/%3e%3cpath%20d='M58%2086c-6-4-12-10-14-18%202-6%208-12%2014-14-6%208-6%2024%200%2032Z'%20fill='%230AF0FF'%20opacity='0.55'%20/%3e%3cpath%20d='M102%2086c6-4%2012-10%2014-18-2-6-8-12-14-14%206%208%206%2024%200%2032Z'%20fill='%230AF0FF'%20opacity='0.55'%20/%3e%3c/svg%3e",import.meta.url).href;const m=document.getElementById("game-canvas"),v=document.getElementById("ui"),n=m.getContext("2d"),S=N(),h=document.createElement("div");h.className="overlay";h.style.display="none";v.appendChild(h);const P={action:(r==null?void 0:r.input.keys.swing)||"Space",restart:(r==null?void 0:r.input.keys.restart)||"KeyR"},X=W({container:document.body,input:S,mapping:{actionA:P.action,actionALabel:"Frapper"},autoShow:!1,showPad:!1}),s=(r==null?void 0:r.difficultyParams)??{},y=s.minAngle??20,b=s.maxAngle??68,e={phase:"angle",running:!1,width:0,height:0,groundY:0,startX:120,cameraX:0,angle:F(y,b,.5),power:.5,angleTimer:0,powerTimer:0,distance:0,best:z,wind:0,penguin:{x:0,y:0,vx:0,vy:0,rotation:0},objects:[],nextSpawnX:0,particles:[],actionHeld:!1,lastBoost:0};function B(){m.width=window.innerWidth*devicePixelRatio,m.height=window.innerHeight*devicePixelRatio,e.width=m.width/devicePixelRatio,e.height=m.height/devicePixelRatio,e.groundY=e.height*.72}B();window.addEventListener("resize",B);const E=_({update:t=>ae(t),render:ge,fps:60});function V(){const t=s.courseLength??4200,i=Math.max(6,Math.floor((s.mineCount??6)+(s.trapCount??4))),a=t/i,o=Math.max(140,s.obstacleSpacingMin??a*.55),c=Math.max(o+80,s.obstacleSpacingMax??a*1.4);return{spacingMin:o,spacingMax:c}}function q(){const t=Math.max(1,Math.floor(s.mineCount??6)),i=Math.max(1,Math.floor(s.trapCount??4));return t/(t+i)}function K(t){const{spacingMin:i,spacingMax:a}=V(),o=q();for(;e.nextSpawnX<t;)e.nextSpawnX+=g(i,a),e.objects.push({x:e.nextSpawnX,type:U(o)?"mine":"trap",triggered:!1})}function J(){const t=e.cameraX-e.width*.8;e.objects=e.objects.filter(i=>i.x>=t)}function Y(){const t=s.spawnAheadDistance??Math.max(1e3,e.width*2);K(e.penguin.x+t),J()}function Q(){e.phase="angle",e.angleTimer=0,e.powerTimer=0,e.angle=F(y,b,.5),e.power=.5,e.distance=0,e.cameraX=0,e.penguin.x=e.startX,e.penguin.y=e.groundY-12,e.penguin.vx=0,e.penguin.vy=0,e.penguin.rotation=0,e.wind=g(-(s.windMax??42),s.windMax??42),e.objects=[],e.nextSpawnX=e.startX,Y(),e.particles=[],e.lastBoost=0,e.actionHeld=!1}function L(){if(!r){A("Config à compléter","Ajoute configs/games/yeti.config.json",!1);return}Q(),X.show(),h.style.display="none",e.running=!0,e.phase="angle",T({type:"SESSION_START",gameId:f}),E.start()}function j(t,i){e.running=!1,e.phase="end",E.stop(),X.hide();const a=Math.floor(e.distance);T({type:t?"SESSION_WIN":"SESSION_FAIL",gameId:f,payload:{score:a}}),r&&Z(f,r.saveSchemaVersion,p=>{const u=p.state.bestDistance||0;e.distance>u&&(p.state.bestDistance=a,p.bestScore=a)}),e.best=Math.max(e.best,a);const c=i??(r==null?void 0:r.uiText.help)??"";A(t?"Vol record !":"Fin du vol",`${c}<br/><strong>${a} m</strong> atteints.`)}function A(t,i,a=!0){X.hide(),h.style.display="grid",h.innerHTML=`
    <div class="panel">
      <p class="pill">Yeti Launch</p>
      <h2>${t}</h2>
      <p>${i}</p>
      <div class="cta-row">
        ${a?'<button class="btn" id="play-btn">Frapper</button>':""}
        <a class="btn secondary" href="${H("/apps/hub/")}">Hub</a>
      </div>
    </div>
  `;const o=document.getElementById("play-btn");o==null||o.addEventListener("click",L)}A((r==null?void 0:r.uiText.title)||"Lance le pingouin",(r==null?void 0:r.uiText.help)||"Appuie sur Espace pour figer l'angle, puis une seconde fois pour verrouiller la puissance. Les mines relancent ton vol, évite les pieux.");function I(t,i,a,o,c){for(let p=0;p<o;p++){const u=g(-Math.PI/2-.8,-Math.PI/2+.8);e.particles.push({x:t,y:i,vx:Math.cos(u)*g(c*.5,c),vy:Math.sin(u)*g(c*.5,c),life:g(.4,.9),color:a})}}function ee(t){const i=s.mineLift??1200,a=s.mineBoost??260;e.penguin.vy=-i*g(.92,1.1),e.penguin.vx+=a*g(.85,1.2),e.lastBoost=.5,I(t.x,e.groundY-4,"rgba(255,255,255,0.9)",24,520),T({type:"MINE_BOOST",gameId:f})}function te(t){I(t.x,e.groundY-8,"rgba(255,116,116,0.9)",16,360),e.penguin.vx=0,e.penguin.vy=0,e.penguin.rotation=0,j(!1,"Le pingouin est stoppé net par un piège !")}function ne(t,i){const a=Math.min(t,i)-26,o=Math.max(t,i)+26;for(const c of e.objects)if(!c.triggered&&c.x>=a&&c.x<=o){c.triggered=!0,c.type==="mine"?ee(c):te(c);return}}function ae(t){if(!r||e.phase==="end")return;if(S.isDown(P.restart)&&!e.running){L();return}const a=S.isDown(P.action),o=a&&!e.actionHeld;if(e.actionHeld=a,!!e.running){if(e.phase==="angle"){e.angleTimer+=t*(s.aimSpeed??2.4);const c=(Math.sin(e.angleTimer)+1)/2;e.angle=F(y,b,c),o&&(e.phase="power",e.powerTimer=0)}else e.phase==="power"?(e.powerTimer+=t*(s.powerSpeed??3.1),e.power=(Math.sin(e.powerTimer)+1)/2,o&&ie()):e.phase==="flight"&&(oe(t),o&&e.penguin.y>=e.groundY-40&&e.penguin.vy>-60&&(e.penguin.vy=-220,e.penguin.vx+=40));e.lastBoost>0&&(e.lastBoost=Math.max(0,e.lastBoost-t))}}function ie(){const t=s.basePower??900,i=e.angle*Math.PI/180,a=t*(.45+e.power*.75);e.penguin.vx=Math.cos(i)*a+e.wind*.8,e.penguin.vy=-Math.sin(i)*a,e.phase="flight"}function oe(t){const i=s.gravity??1700,a=s.airDrag??60,o=s.groundDrag??220,c=e.penguin.x;e.penguin.vy+=i*t;const p=Math.sign(e.penguin.vx)*a*t;e.penguin.vx=Math.sign(e.penguin.vx)*Math.max(0,Math.abs(e.penguin.vx)-Math.abs(p)),e.penguin.vx+=e.wind/8*t,e.penguin.vx=Math.max(0,e.penguin.vx),e.penguin.x+=e.penguin.vx*t,e.penguin.y+=e.penguin.vy*t,Y();let u=!1;if(e.penguin.y>=e.groundY){e.penguin.y=e.groundY,u=!0;const l=Math.abs(e.penguin.vy);if(l>240?(e.penguin.vy=-l*(s.bounceFactor??.58),e.penguin.vx*=.98,I(e.penguin.x,e.groundY-2,"rgba(255,255,255,0.8)",10,280)):(e.penguin.vy=0,e.penguin.vx=Math.max(0,e.penguin.vx-o*t)),ne(c,e.penguin.x),!e.running)return}e.distance=Math.max(0,e.penguin.x-e.startX),e.cameraX=Math.max(0,e.penguin.x-e.width*.35),e.penguin.rotation=Math.atan2(e.penguin.vy,e.penguin.vx);const k=e.phase==="flight"?.01:0;if(e.wind=x(e.wind+g(-1,1)*k,-(s.windMax??42),s.windMax??42),u&&e.lastBoost<=.05&&Math.abs(e.penguin.vx)<12&&Math.abs(e.penguin.vy)<10){const l=s.winDistance??900;j(e.distance>=l)}e.particles=e.particles.map(l=>({...l,life:l.life-t,x:l.x+l.vx*t,y:l.y+l.vy*t+18*t})).filter(l=>l.life>.05)}function se(){const t=n.createLinearGradient(0,0,0,e.height);t.addColorStop(0,"rgba(108, 190, 255, 0.4)"),t.addColorStop(.5,"rgba(23, 49, 87, 0.6)"),t.addColorStop(1,"rgba(8, 18, 33, 1)"),n.fillStyle=t,n.fillRect(0,0,e.width,e.height),n.save(),n.translate(-e.cameraX*.15,0);const i=e.height*.42;n.fillStyle="rgba(255,255,255,0.14)",n.beginPath(),n.moveTo(-200,i+20);for(let a=0;a<6;a++){const o=a*240+60;n.lineTo(o,i+g(-40,30))}n.lineTo(e.width+400,i+60),n.lineTo(e.width+400,e.height),n.lineTo(-200,e.height),n.closePath(),n.fill(),n.restore()}function re(){n.save(),n.translate(-e.cameraX,0),n.fillStyle="rgba(15, 32, 50, 0.9)";const t=e.cameraX-400,i=e.cameraX+e.width+400;n.fillRect(t,e.groundY,i-t,e.height-e.groundY),n.fillStyle="rgba(255,255,255,0.6)";const a=140,o=80,c=Math.floor(t/a)*a;for(let p=c;p<i;p+=a)n.fillRect(p,e.groundY-6,o,2);n.restore()}function ce(){n.save(),n.translate(-e.cameraX,0);for(const t of e.objects)t.type==="mine"?(n.fillStyle=t.triggered?"rgba(255,255,255,0.4)":"rgba(255,255,255,0.9)",n.beginPath(),n.arc(t.x,e.groundY-6,14,0,Math.PI*2),n.fill(),n.fillStyle="rgba(91, 179, 255, 0.9)",n.fillRect(t.x-10,e.groundY-20,20,8)):(n.fillStyle="rgba(255,116,116,0.9)",n.beginPath(),n.moveTo(t.x-10,e.groundY),n.lineTo(t.x,e.groundY-30),n.lineTo(t.x+10,e.groundY),n.closePath(),n.fill());n.restore()}function le(){var a;n.save(),n.translate(-e.cameraX,0);const t=e.startX-48,i=e.groundY-46;n.fillStyle="rgba(255,255,255,0.85)",n.beginPath(),n.roundRect(t-12,i,52,58,12),n.fill(),n.fillStyle="rgba(0,0,0,0.4)",n.fillRect(t+12,i+10,18,10),n.strokeStyle=((a=d==null?void 0:d.colors)==null?void 0:a.accent)||"#4dddbb",n.lineWidth=5,n.beginPath(),n.moveTo(t-6,i+10),n.lineTo(t+40,i-18),n.stroke(),n.restore()}function pe(){n.save(),n.translate(-e.cameraX+e.penguin.x,e.penguin.y),n.rotate(e.penguin.rotation);const t=56;M.complete?n.drawImage(M,-t/2,-t/2,t,t):(n.fillStyle="rgba(255,255,255,0.9)",n.beginPath(),n.arc(0,0,t/3,0,Math.PI*2),n.fill()),n.restore()}function de(){n.save(),n.translate(-e.cameraX,0);for(const t of e.particles)n.globalAlpha=x(t.life,0,1),n.fillStyle=t.color,n.beginPath(),n.arc(t.x,t.y,3,0,Math.PI*2),n.fill();n.globalAlpha=1,n.restore()}function ge(){n.save(),n.scale(devicePixelRatio,devicePixelRatio),n.clearRect(0,0,e.width,e.height),se(),re(),ce(),le(),pe(),de(),n.restore(),ue()}function ue(){v.innerHTML="",v.appendChild(h);const t=document.createElement("div");t.className="hud";const i=e.phase==="angle"?"Choisis l'angle":e.phase==="power"?"Charge la frappe":e.phase==="flight"?"En vol":"Pause",a=x((e.angle-y)/(b-y),0,1)*100,o=x(e.power,0,1)*100;t.innerHTML=`
    <div class="pill">Distance ${Math.floor(e.distance)} m</div>
    <div class="pill">Record ${Math.floor(e.best)} m</div>
    <div class="pill">Vent ${e.wind.toFixed(0)} km/h</div>
    <div class="pill">${i}</div>
    <div class="meters">
      <div class="meter">
        <div class="label">Angle</div>
        <div class="bar"><span style="width:${a}%"></span></div>
        <small>${e.angle.toFixed(0)}°</small>
      </div>
      <div class="meter">
        <div class="label">Puissance</div>
        <div class="bar"><span style="width:${o}%"></span></div>
        <small>${Math.round(o)}%</small>
      </div>
    </div>
  `,v.appendChild(t)}
