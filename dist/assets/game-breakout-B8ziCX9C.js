import{m as te,e as se,f as ae,l as ie,p,q as X,w as oe,n as k,k as G,t as re}from"./index-D6AlT0_O.js";import{c as ne,a as le}from"./input-CrBvr0XE.js";import{c as ce}from"./loop-24SuRqx9.js";const g="breakout",o=te(g),O=se(),d=O.find(t=>t.id===(o==null?void 0:o.themeId))||O[0];ae();if(d){const t=document.documentElement.style;t.setProperty("--color-primary",d.colors.primary),t.setProperty("--color-secondary",d.colors.secondary),t.setProperty("--color-accent",d.colors.accent),t.setProperty("--color-text",d.colors.text),t.setProperty("--color-muted",d.colors.muted),t.setProperty("--color-bg",d.colors.background),document.body.style.background=d.gradient||d.colors.background}const B=document.getElementById("game-root"),m=document.getElementById("game-canvas"),b=document.getElementById("ui"),r=m.getContext("2d"),T=ne(),S=document.createElement("div");S.className="overlay";S.style.display="none";b.appendChild(S);const E=document.createElement("div");E.className="toast-layer";B.appendChild(E);const x={left:(o==null?void 0:o.input.keys.left)||"ArrowLeft",right:(o==null?void 0:o.input.keys.right)||"ArrowRight",altLeft:(o==null?void 0:o.input.keys.altLeft)||"KeyQ",altRight:(o==null?void 0:o.input.keys.altRight)||"KeyD",launch:(o==null?void 0:o.input.keys.launch)||"Space"};var j,F;const de=typeof window<"u"&&(((F=(j=window.matchMedia)==null?void 0:j.call(window,"(pointer: coarse)"))==null?void 0:F.matches)||navigator.maxTouchPoints>0),A=de?le({container:document.body,input:T,mapping:{left:x.left,right:x.right,actionA:x.launch,actionALabel:"Lancer"},autoShow:!1,showPad:!0,gestureEnabled:!1,showOnDesktop:!1}):{show:()=>{},hide:()=>{},dispose:()=>{}},C=(o==null?void 0:o.difficultyParams.rows)??6,R=(o==null?void 0:o.difficultyParams.cols)??10,I=(o==null?void 0:o.difficultyParams.lives)??3,$=(o==null?void 0:o.difficultyParams.ballSpeed)??320,D=(o==null?void 0:o.difficultyParams.pointsPerBrick)??10,v={easy:{label:"Facile",rows:Math.max(4,C-1),cols:Math.max(6,R-2),lives:Math.max(3,I+1),ballSpeed:Math.round($*.9),pointsPerBrick:Math.max(6,D),brickDensity:.55,powerupChance:.22},medium:{label:"Moyen",rows:C,cols:R,lives:I,ballSpeed:$,pointsPerBrick:D,brickDensity:.7,powerupChance:.18},hard:{label:"Difficile",rows:C+1,cols:R+1,lives:Math.max(2,I-1),ballSpeed:Math.round($*1.1),pointsPerBrick:D+2,brickDensity:.82,powerupChance:.16},extreme:{label:"Extreme",rows:C+2,cols:R+2,lives:1,ballSpeed:Math.round($*1.2),pointsPerBrick:D+4,brickDensity:.92,powerupChance:.14}};let P="medium";const w=v[P],q=[{type:"extra-ball",label:"Balles supplementaires",symbol:"+1",color:d.colors.primary,kind:"bonus",weight:3},{type:"speed-up",label:"Vitesse acceleree",symbol:"V+",color:"#f97316",kind:"malus",duration:6,speedMultiplier:1.35,weight:2},{type:"invert-controls",label:"Touches inversees",symbol:"INV",color:"#fb7185",kind:"malus",duration:6,weight:2},{type:"screen-shake",label:"Ecran qui tremble",symbol:"SHA",color:"#f43f5e",kind:"malus",duration:1.4,weight:1}];var V;const e={running:!1,width:0,height:0,dpr:devicePixelRatio||1,play:{x:0,y:0,w:0,h:0},paddle:{x:0,y:0,w:120,h:16,speed:640},balls:[],ballRadius:8,rows:w.rows,cols:w.cols,brickGap:p((o==null?void 0:o.difficultyParams.brickGap)??8,4,14),brickHeight:22,bricks:[],bricksRemaining:0,totalBricks:0,clearedRows:new Set,score:0,best:((V=ie().games[g])==null?void 0:V.bestScore)??0,lives:w.lives,ballSpeed:w.ballSpeed,ballSpeedMultiplier:1,pointsPerBrick:w.pointsPerBrick,brickDensity:w.brickDensity,powerupChance:w.powerupChance,powerupSize:20,powerupFallSpeed:160,powerups:[],invertTimer:0,speedTimer:0,shakeTimer:0,shakeDuration:0,launchHeld:!1,flash:0},Y=ce({update:t=>Re(t),render:ee,fps:60});function _(){const t={...e.play};if(e.dpr=devicePixelRatio||1,m.width=window.innerWidth*e.dpr,m.height=window.innerHeight*e.dpr,m.style.width="100%",m.style.height="100%",e.width=m.width/e.dpr,e.height=m.height/e.dpr,pe(),t.w>0&&t.h>0){const a=(e.paddle.x-t.x)/t.w;e.paddle.x=e.play.x+p(a,0,1)*e.play.w,e.balls.forEach(s=>{if(s.stuck)return;const i=(s.x-t.x)/t.w,n=(s.y-t.y)/t.h;s.x=e.play.x+i*e.play.w,s.y=e.play.y+n*e.play.h}),e.powerups.forEach(s=>{const i=(s.x-t.x)/t.w,n=(s.y-t.y)/t.h;s.x=e.play.x+i*e.play.w,s.y=e.play.y+n*e.play.h})}else e.paddle.x=e.play.x+(e.play.w-e.paddle.w)/2;e.balls.some(a=>a.stuck)&&Q(),he()}function pe(){const t=Math.max(16,Math.min(e.width,e.height)*.05),a=Math.min(e.width-t*2,920),s=e.height-t*2;e.play.x=(e.width-a)/2,e.play.y=t,e.play.w=a,e.play.h=s,e.paddle.w=p((o==null?void 0:o.difficultyParams.paddleWidth)??a*.24,a*.16,a*.34),e.paddle.h=p(Math.floor(s*.03),10,18),e.paddle.y=e.play.y+e.play.h-e.paddle.h-Math.max(16,s*.04),e.ballRadius=p(Math.floor(a*.012),6,10),e.brickGap=p((o==null?void 0:o.difficultyParams.brickGap)??8,4,14),e.brickHeight=p(Math.floor(s*.045),16,28),e.powerupSize=p(Math.floor(a*.03),16,26),e.powerupFallSpeed=p(s*.22,120,240),e.balls.forEach(i=>{i.r=e.ballRadius}),e.powerups.forEach(i=>{i.size=e.powerupSize,i.vy=e.powerupFallSpeed})}function he(){if(!e.bricks.length)return;const t=(e.play.w-e.brickGap*(e.cols-1))/e.cols,a=e.play.x,s=e.play.y+Math.max(18,e.play.h*.08);e.bricks.forEach(i=>{i.w=t,i.h=e.brickHeight,i.x=a+i.col*(t+e.brickGap),i.y=s+i.row*(e.brickHeight+e.brickGap)})}function K(){const t=[d.colors.primary,d.colors.secondary,d.colors.accent,"#ffd166","#7ce7ff"],a=(e.play.w-e.brickGap*(e.cols-1))/e.cols,s=e.play.x,i=e.play.y+Math.max(18,e.play.h*.08);e.bricks=[],e.clearedRows=new Set;const n=p(e.brickDensity,.2,1),c=e.rows*e.cols,h=Math.round(c*n),M=Math.max(4,Math.floor(h*.6)),u=[],y=(l,f)=>{e.bricks.push({x:s+f*(a+e.brickGap),y:i+l*(e.brickHeight+e.brickGap),w:a,h:e.brickHeight,row:l,col:f,alive:!0,color:t[l%t.length]})};for(let l=0;l<e.rows;l+=1)for(let f=0;f<e.cols;f+=1)X(n)?y(l,f):u.push({row:l,col:f});if(e.bricks.length<M&&u.length>0){for(let l=u.length-1;l>0;l-=1){const f=Math.floor(k(0,l+1));[u[l],u[f]]=[u[f],u[l]]}for(const l of u){if(e.bricks.length>=M)break;y(l.row,l.col)}}e.bricks.length===0&&y(Math.floor(e.rows/2),Math.floor(e.cols/2)),e.totalBricks=e.bricks.length,e.bricksRemaining=e.totalBricks}function Q(){e.balls.forEach(t=>{t.stuck&&(t.x=e.paddle.x+e.paddle.w/2,t.y=e.paddle.y-t.r-4)})}function ue(t){return{x:e.paddle.x+e.paddle.w/2,y:e.paddle.y-e.ballRadius-4,vx:0,vy:0,r:e.ballRadius,stuck:t}}function z(){e.balls=[ue(!0)]}function N(){return e.ballSpeed*e.ballSpeedMultiplier}function W(t){const a=p(t,.6,1.6);if(a===e.ballSpeedMultiplier)return;const s=a/e.ballSpeedMultiplier;e.ballSpeedMultiplier=a,e.balls.forEach(i=>{i.stuck||(i.vx*=s,i.vy*=s)})}function ye(t,a){W(t),e.speedTimer=a}function fe(t){e.shakeTimer=t,e.shakeDuration=t}function me(){e.shakeTimer=0,e.shakeDuration=0,B.style.transform=""}function ve(){const t=Math.PI/3,a=N();e.balls.forEach(s=>{if(!s.stuck)return;const i=-Math.PI/2+k(-t/2,t/2);s.vx=Math.cos(i)*a,s.vy=Math.sin(i)*a,s.stuck=!1})}function we(t){const a=e.paddle.x+e.paddle.w/2,s=e.paddle.y-e.ballRadius-4,i=Math.PI/2.2,n=N();for(let c=0;c<t;c+=1){const h=-Math.PI/2+k(-i/2,i/2);e.balls.push({x:a+k(-12,12),y:s,vx:Math.cos(h)*n,vy:Math.sin(h)*n,r:e.ballRadius,stuck:!1})}}function xe(t,a){const s=document.createElement("div");s.className=`toast ${a}`,s.textContent=t,E.appendChild(s),requestAnimationFrame(()=>{s.classList.add("show")}),window.setTimeout(()=>{s.classList.remove("show"),window.setTimeout(()=>s.remove(),220)},1400)}function ke(){const t=q.reduce((s,i)=>s+i.weight,0);let a=k(0,t);for(const s of q)if(a-=s.weight,a<=0)return s;return q[0]}function be(t,a){const s=ke();e.powerups.push({x:t,y:a,vy:e.powerupFallSpeed+k(-20,40),size:e.powerupSize,type:s.type,label:s.label,symbol:s.symbol,color:s.color,kind:s.kind,duration:s.duration,speedMultiplier:s.speedMultiplier})}function ge(t){X(e.powerupChance)&&be(t.x+t.w/2,t.y+t.h/2)}function Se(t){const a=t.kind==="bonus"?"Bonus":"Malus";switch(xe(`${a}: ${t.label}`,t.kind),t.type){case"extra-ball":we(2);break;case"speed-up":ye(t.speedMultiplier??1.3,t.duration??6);break;case"invert-controls":e.invertTimer=t.duration??6;break;case"screen-shake":fe(t.duration??1.2);break}}function Me(t){const a=e.paddle,s=e.play.y+e.play.h;e.powerups=e.powerups.filter(i=>(i.y+=i.vy*t,i.y-i.size>s?!1:i.y+i.size/2>=a.y&&i.y-i.size/2<=a.y+a.h&&i.x>=a.x&&i.x<=a.x+a.w?(Se(i),!1):!0))}function U(t){e.rows=t.rows,e.cols=t.cols,e.lives=t.lives,e.ballSpeed=t.ballSpeed,e.pointsPerBrick=t.pointsPerBrick,e.brickDensity=p(t.brickDensity,.2,1),e.powerupChance=p(t.powerupChance,.05,.4)}function J(){e.invertTimer=0,e.speedTimer=0,W(1),me()}function Te(){if(!o){H("Config manquante","Ajoute configs/games/breakout.config.json",!1);return}A.show();const t=v[P]||v.medium;U(t),J(),E.innerHTML="",e.running=!0,e.score=0,e.flash=0,e.powerups=[],e.paddle.x=e.play.x+(e.play.w-e.paddle.w)/2,z(),K(),S.style.display="none",m.style.pointerEvents="auto",b.style.pointerEvents="none",G({type:"SESSION_START",gameId:g}),Y.start()}function Z(t){e.running=!1,Y.stop(),A.hide(),J(),e.powerups=[],E.innerHTML="";const a=e.score;G({type:t?"SESSION_WIN":"SESSION_FAIL",gameId:g,payload:{score:a}}),re(g,(o==null?void 0:o.saveSchemaVersion)??1,n=>{const c=n.bestScore||0;a>c&&(n.bestScore=a);const h=e.totalBricks-e.bricksRemaining,M=n.state.bestBricks||0;h>M&&(n.state.bestBricks=h)}),e.best=Math.max(e.best,a),H(t?"Victoire":"Perdu",(o==null?void 0:o.uiText.help)||"Relance une partie pour battre ton record.",!0,a)}function Pe(){e.lives=Math.max(0,e.lives-1),e.flash=1,e.lives<=0?Z(!1):z()}function Be(t){t.alive&&(t.alive=!1,e.bricksRemaining-=1,e.score+=e.pointsPerBrick,G({type:"BRICK_BROKEN",gameId:g,payload:{score:e.score}}),ge(t),e.clearedRows.has(t.row)||!e.bricks.some(s=>s.alive&&s.row===t.row)&&(e.clearedRows.add(t.row),G({type:"ROW_CLEARED",gameId:g})),e.bricksRemaining<=0&&Z(!0))}function Ee(t){if(e.speedTimer>0&&(e.speedTimer=Math.max(0,e.speedTimer-t),e.speedTimer===0&&W(1)),e.invertTimer>0&&(e.invertTimer=Math.max(0,e.invertTimer-t)),e.shakeTimer>0&&(e.shakeTimer=Math.max(0,e.shakeTimer-t)),e.shakeTimer>0){const a=e.shakeDuration>0?e.shakeTimer/e.shakeDuration:0,s=Math.max(1,8*a);B.style.transform=`translate(${k(-s,s)}px, ${k(-s,s)}px)`}else B.style.transform&&(B.style.transform="")}function Ce(t){e.balls.some(a=>a.stuck)&&Q();for(let a=e.balls.length-1;a>=0;a-=1){const s=e.balls[a];if(s.stuck)continue;s.x+=s.vx*t,s.y+=s.vy*t,$e(s)&&e.balls.splice(a,1)}e.balls.length===0&&Pe()}function Re(t){if(!e.running)return;Ee(t);const a=T.isDown(x.left)||T.isDown(x.altLeft),i=(T.isDown(x.right)||T.isDown(x.altRight)?1:0)-(a?1:0),n=e.invertTimer>0?-i:i;n!==0&&(e.paddle.x+=n*e.paddle.speed*t),e.paddle.x=p(e.paddle.x,e.play.x,e.play.x+e.play.w-e.paddle.w);const c=T.isDown(x.launch);e.balls.some(h=>h.stuck)&&c&&!e.launchHeld&&ve(),e.launchHeld=c,Ce(t),e.running&&(Me(t),e.flash=Math.max(0,e.flash-t*2))}function $e(t){const a=e.play;if(t.x-t.r<=a.x&&(t.x=a.x+t.r,t.vx=Math.abs(t.vx)),t.x+t.r>=a.x+a.w&&(t.x=a.x+a.w-t.r,t.vx=-Math.abs(t.vx)),t.y-t.r<=a.y&&(t.y=a.y+t.r,t.vy=Math.abs(t.vy)),t.y-t.r>a.y+a.h)return!0;if(t.vy>0&&t.y+t.r>=e.paddle.y&&t.y-t.r<=e.paddle.y+e.paddle.h&&t.x>=e.paddle.x&&t.x<=e.paddle.x+e.paddle.w){const s=(t.x-(e.paddle.x+e.paddle.w/2))/(e.paddle.w/2),n=p(s,-1,1)*(Math.PI/3),c=N();t.vx=Math.sin(n)*c,t.vy=-Math.cos(n)*c,t.y=e.paddle.y-t.r-.5}for(const s of e.bricks){if(!s.alive||t.x+t.r<s.x||t.x-t.r>s.x+s.w||t.y+t.r<s.y||t.y-t.r>s.y+s.h)continue;const i=Math.min(t.x+t.r-s.x,s.x+s.w-(t.x-t.r)),n=Math.min(t.y+t.r-s.y,s.y+s.h-(t.y-t.r));i<n?t.vx*=-1:t.vy*=-1,Be(s);break}return!1}function L(t,a,s,i,n){const c=Math.min(n,s/2,i/2);r.beginPath(),r.moveTo(t+c,a),r.lineTo(t+s-c,a),r.quadraticCurveTo(t+s,a,t+s,a+c),r.lineTo(t+s,a+i-c),r.quadraticCurveTo(t+s,a+i,t+s-c,a+i),r.lineTo(t+c,a+i),r.quadraticCurveTo(t,a+i,t,a+i-c),r.lineTo(t,a+c),r.quadraticCurveTo(t,a,t+c,a),r.closePath()}function De(){e.powerups.length&&(r.save(),r.textAlign="center",r.textBaseline="middle",e.powerups.forEach(t=>{const a=t.size,s=a/2,i=r.createLinearGradient(t.x-s,t.y-s,t.x+s,t.y+s);i.addColorStop(0,t.color),i.addColorStop(1,`${t.color}cc`),r.fillStyle=i,L(t.x-s,t.y-s,a,a,8),r.fill(),r.strokeStyle="rgba(255,255,255,0.28)",r.lineWidth=1,r.stroke(),r.fillStyle="#0b1020",r.font=`700 ${Math.max(10,a*.45)}px "Space Grotesk", "Sora", system-ui, sans-serif`,r.fillText(t.symbol,t.x,t.y+.5)}),r.restore())}function ee(){r.save(),r.scale(e.dpr,e.dpr),r.clearRect(0,0,e.width,e.height);const t=r.createLinearGradient(0,0,e.width,e.height);t.addColorStop(0,"rgba(96,165,250,0.08)"),t.addColorStop(.5,"rgba(251,191,36,0.05)"),t.addColorStop(1,"rgba(244,114,182,0.08)"),r.fillStyle=t,r.fillRect(0,0,e.width,e.height),r.fillStyle="rgba(255,255,255,0.04)",L(e.play.x,e.play.y,e.play.w,e.play.h,18),r.fill(),r.strokeStyle="rgba(255,255,255,0.12)",r.lineWidth=1.2,r.stroke(),e.bricks.forEach(s=>{if(!s.alive)return;const i=r.createLinearGradient(s.x,s.y,s.x,s.y+s.h);i.addColorStop(0,s.color),i.addColorStop(1,`${s.color}cc`),r.fillStyle=i,L(s.x,s.y,s.w,s.h,8),r.fill(),r.strokeStyle="rgba(255,255,255,0.18)",r.lineWidth=1,r.stroke()}),De();const a=r.createLinearGradient(e.paddle.x,e.paddle.y,e.paddle.x+e.paddle.w,e.paddle.y);a.addColorStop(0,d.colors.secondary),a.addColorStop(1,d.colors.primary),r.fillStyle=a,L(e.paddle.x,e.paddle.y,e.paddle.w,e.paddle.h,10),r.fill(),e.balls.forEach(s=>{const i=r.createRadialGradient(s.x-s.r*.4,s.y-s.r*.4,s.r*.2,s.x,s.y,s.r);i.addColorStop(0,"#ffffff"),i.addColorStop(1,d.colors.accent),r.fillStyle=i,r.beginPath(),r.arc(s.x,s.y,s.r,0,Math.PI*2),r.fill()}),r.restore(),Le()}function Le(){b.innerHTML="",b.appendChild(S);const t=e.totalBricks-e.bricksRemaining,a=v[P]||v.medium,s=e.balls.some(c=>c.stuck),i=document.createElement("div");i.className="hud",i.innerHTML=`
    <div class="chip">Score <strong>${e.score}</strong></div>
    <div class="chip">Briques <strong>${t}/${e.totalBricks}</strong></div>
    <div class="chip ghost">Vies <span>${e.lives}</span></div>
    <div class="chip ghost">Record <span>${e.best}</span></div>
    <div class="chip ghost">Niveau <span>${a.label}</span></div>
  `,b.appendChild(i);const n=document.createElement("div");n.className="hud bottom",n.innerHTML=`
    <div class="pill ${s?"glow":""}">${s?"Pret a lancer":`Balles ${e.balls.length}`}</div>
    <div class="pill ghost">${s?"Espace pour lancer":"Attrape les bonus/malus"}</div>
  `,b.appendChild(n)}function H(t,a,s=!0,i){var u;A.hide();const n=v[P]||v.medium;S.style.display="grid",b.style.pointerEvents="auto",m.style.pointerEvents="none";const c=((o==null?void 0:o.uiText.controls)||[]).map(y=>`<span class="chip ghost">${y}</span>`).join(""),h=Math.round(n.rows*n.cols*n.brickDensity),M="Bonus/Malus tombent : balles +, vitesse acceleree, touches inversees, ecran qui tremble.";S.innerHTML=`
    <div class="panel">
      <p class="pill">${(o==null?void 0:o.uiText.title)||"Casse-briques"} · ${n.label}</p>
      <h2>${t}</h2>
      ${i!==void 0?`<p class="muted">Score ${i}</p>`:""}
      <p class="muted">${a}</p>
      <p class="muted">${M}</p>
      <div class="panel-actions" style="justify-content:flex-start;">
        ${Object.entries(v).map(([y,l])=>`
              <button class="btn ghost diff-btn ${y===P?"active":""}" data-diff="${y}">
                ${l.label} · ${l.rows}x${l.cols} · ${l.lives} vie${l.lives>1?"s":""}
              </button>
            `).join("")}
      </div>
      <div class="panel-actions">
        ${s?'<button class="btn" id="start-btn">Lancer</button>':""}
        <a class="btn ghost" href="${oe("/")}">Hub</a>
      </div>
      <div class="inline-metrics">
        <div><span>Record</span><strong>${e.best}</strong></div>
        <div><span>Briques</span><strong>~${h}</strong></div>
        <div><span>Vies</span><strong>${n.lives}</strong></div>
      </div>
      <div class="controls">${c}</div>
    </div>
  `,(u=document.getElementById("start-btn"))==null||u.addEventListener("click",Te),document.querySelectorAll(".diff-btn").forEach(y=>{y.addEventListener("click",()=>{const l=y.dataset.diff;l&&v[l]&&(P=l,H(t,a,s,i))})})}_();window.addEventListener("resize",_);U(w);K();e.paddle.x=e.play.x+(e.play.w-e.paddle.w)/2;z();H((o==null?void 0:o.uiText.title)||"Casse-briques",(o==null?void 0:o.uiText.help)||"");ee();
